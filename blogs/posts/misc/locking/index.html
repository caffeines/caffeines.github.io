<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Understanding Locking: Pessimistic and Optimistic Approaches | Caffeines</title><meta name=keywords content="Locking,Database"><meta name=description content="Two primary approaches to locking are pessimistic and optimistic locking"><meta name=author content="Sadat Sayem"><link rel=canonical href=https://www.sadat.me/blogs/posts/misc/locking/><link crossorigin=anonymous href=https://www.sadat.me/blogs/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://www.sadat.me/blogs/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.sadat.me/blogs/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.sadat.me/blogs/favicon-32x32.png><link rel=apple-touch-icon href=https://www.sadat.me/blogs/apple-touch-icon.png><link rel=mask-icon href=https://www.sadat.me/blogs/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.sadat.me/blogs/posts/misc/locking/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://www.sadat.me/blogs/posts/misc/locking/"><meta property="og:site_name" content="Caffeines"><meta property="og:title" content="Understanding Locking: Pessimistic and Optimistic Approaches"><meta property="og:description" content="Two primary approaches to locking are pessimistic and optimistic locking"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-11T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-11T00:00:00+00:00"><meta property="article:tag" content="Locking"><meta property="article:tag" content="Database"><meta property="og:image" content="https://www.sadat.me/blogs/images/locking.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.sadat.me/blogs/images/locking.png"><meta name=twitter:title content="Understanding Locking: Pessimistic and Optimistic Approaches"><meta name=twitter:description content="Two primary approaches to locking are pessimistic and optimistic locking"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.sadat.me/blogs/posts/"},{"@type":"ListItem","position":2,"name":"Understanding Locking: Pessimistic and Optimistic Approaches","item":"https://www.sadat.me/blogs/posts/misc/locking/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Understanding Locking: Pessimistic and Optimistic Approaches","name":"Understanding Locking: Pessimistic and Optimistic Approaches","description":"Two primary approaches to locking are pessimistic and optimistic locking","keywords":["Locking","Database"],"articleBody":"In the world of concurrent programming and database management, locking mechanisms are crucial to ensure data consistency and integrity. Two primary approaches to locking are pessimistic and optimistic locking. Each has its own use cases, advantages, and disadvantages. In this blog post we will understand of these two approaches, along with the real-world examples and an introduction to the Compare-and-Swap (CAS) mechanism.\nPessimistic Locking Pessimistic locking is a strategy where a resource is locked as soon as a transaction starts and remains locked until the transaction is completed. It has been called “pessimistic” because of the assumption that conflicts between concurrent transactions do occur frequently.\nHow It Works Lock Acquisition: If a transaction needs to read or write to certain resources, then it first acquires a lock on those resources. Exclusive access: No other transaction can access the resource under lock until it is released. Lock Release: The lock is released when the transaction is complete, whether through commit or rollback. Real-World Example Let’s think about a banking system where users can transfer their money form accounts. If two users try to transfer money from the same account simultaneously, it could lead to inconsistencies. In this situation the pessimistic locking plays the vital role to save from inconsistencies.\nBEGIN TRANSACTION; SELECT balance FROM accounts WHERE account_id = 12345 FOR UPDATE; -- Perform transfer operations UPDATE accounts SET balance = balance - 100 WHERE account_id = 12345; COMMIT; In this example, the FOR UPDATE clause locks the account record, preventing other transactions from modifying it until the current transaction is complete.\nAdvantages Data Integrity: Ensures that no other transaction can modify the resource while it is being processed, thus maintaining data integrity. Simplicity: Easier to implement and understand, especially in systems where conflicts are frequent. Disadvantages Performance Overhead: Can lead to significant performance bottlenecks, especially in high-concurrency environments. Deadlocks: Increased risk of deadlocks, where two or more transactions are waiting indefinitely for each other to release locks. Optimistic Locking On the other hand, Optimistic locking use to minimize conflicts that can occur when multiple transactions try to access and modify the same data simultaneously. It’s based on the assumption that conflicts are rare, and therefore, it avoids the overhead of pessimistic locking, which involves acquiring exclusive locks on data before accessing it.\nHow It Works Read: A transaction reads the data it needs to modify. Version: A version stamp or timestamp is associated with the data to track its state. Update: The transaction modifies the data as needed. Write: When the transaction is ready to commit, it checks the current version stamp of the data against the version stamp it read at the beginning. Conflict Detection: If the version stamps match, the transaction can commit the changes. If they don’t match, it means that the data has been modified by another transaction since the original read, and a conflict has occurred. Conflict Resolution: In case of a conflict, the transaction can read the data again and retry the update or it can abort the transaction and inform the user about the conflict. Real-World Example Consider an e-commerce platform where multiple users can update product inventory. With optimistic locking, each product record has a version number. When a user updates the inventory, the system checks the version number before committing:\nBEGIN TRANSACTION; SELECT version, stock FROM products WHERE product_id = 98765; -- Perform inventory update UPDATE products SET stock = stock - 1, version = version + 1 WHERE product_id = 98765 AND version = 1; COMMIT; If the version number has changed since the initial read, the update fails, and the transaction is retried.\nAdvantages Performance: Better performance in high-concurrency environments as it reduces the time resources are locked. Scalability: More scalable as it allows multiple transactions to proceed without waiting for locks. Implementation: It’s generally easier to implement than pessimistic locking. Disadvantages Complexity: More complex to implement and manage, especially in systems with frequent conflicts. Retry Overhead: Transactions may need to be retried multiple times, leading to increased overhead. Compare-and-Swap (CAS) Mechanism Compare-and-Swap (CAS) is a hardware-level atomic instruction used for efficient synchronization in multi-threaded programming to avoid locking algorithm.\nHow It Works Read: The CAS operation reads the current value of a variable. Compare: It compares the read value with an expected value that provided. Swap: If the read value matches the expected value, the CAS instruction atomically updates with the new value. If the values don’t match, the CAS instruction fails without modifying. Real-World Example In Go, CAS can be implemented using the sync/atomic package.\npackage main import ( \"fmt\" \"sync\" \"sync/atomic\" ) func main() { var counter atomic.Int32 counter.Store(0) wg := sync.WaitGroup{} wg.Add(100) increment := func() { oldValue, newValue := counter.Load(), counter.Load()+1 swapped := counter.CompareAndSwap(oldValue, newValue) if !swapped { fmt.Println(\"Failed to swap\") } wg.Done() } for i := 0; i \u003c 100; i++ { go increment() } wg.Wait() fmt.Println(counter.Load()) } In this example, CompareAndSwap ensures that the increment operation is performed atomically.\nAdvantages of CAS Higher Performance: CAS is non-blocking by nature operation, which lead to better performance in high concurrent situation. Lower Overhead: CAS doesn’t require the overhead of context switch and thread scheduling, which can be significant to some extent. Disadvantages of CAS Complexity: CAS implementation can be more complex than traditional locking, and it’s true when it comes to understanding the implementation in some cases. Potential for Busy Waiting: If CAS operations fail frequently, it can lead to busy waiting, where threads continuously retry the operation until they succeed. Choosing the Right Approach The choice between pessimistic locking, optimistic locking, and CAS depends on the specific requirements and characteristics of your system:\nHigh Conflict: If your system experiences high contention for resources, pessimistic locking may be more suitable to ensure data integrity. Low Contention: In systems with low contention, optimistic locking can provide better performance and scalability. Complexity vs. Performance: Consider the trade-off between implementation complexity and performance. Pessimistic locking is simpler but may lead to performance bottlenecks, while optimistic locking and CAS are more complex but can offer better performance in the right scenarios. ","wordCount":"1011","inLanguage":"en","image":"https://www.sadat.me/blogs/images/locking.png","datePublished":"2024-03-11T00:00:00Z","dateModified":"2024-03-11T00:00:00Z","author":{"@type":"Person","name":"Sadat Sayem"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sadat.me/blogs/posts/misc/locking/"},"publisher":{"@type":"Organization","name":"Caffeines","logo":{"@type":"ImageObject","url":"https://www.sadat.me/blogs/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.sadat.me/blogs/ accesskey=h title="Caffeines (Alt + H)">Caffeines</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.sadat.me/blogs/categories title=Categories><span>Categories</span></a></li><li><a href=https://www.sadat.me/blogs/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://www.sadat.me/blogs/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://sadat.me title="About Me"><span>About Me</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.sadat.me/blogs/>Home</a>&nbsp;»&nbsp;<a href=https://www.sadat.me/blogs/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Understanding Locking: Pessimistic and Optimistic Approaches</h1><div class=post-description>Two primary approaches to locking are pessimistic and optimistic locking</div><div class=post-meta><span title='2024-03-11 00:00:00 +0000 UTC'>March 11, 2024</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Sadat Sayem&nbsp;|&nbsp;<a href=https://github.com/adityatelange/hugo-PaperMod/tree/exampleSite/content/posts/misc/locking.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager srcset='https://www.sadat.me/blogs/images/locking_hu_51f06a309a2fc962.png 360w,https://www.sadat.me/blogs/images/locking_hu_34cbcbad9e18092e.png 480w,https://www.sadat.me/blogs/images/locking_hu_3b128afda0e7114e.png 720w,https://www.sadat.me/blogs/images/locking_hu_ac2302e3aad48c4f.png 1080w,https://www.sadat.me/blogs/images/locking_hu_a0c1c74ad3f75ae4.png 1500w,https://www.sadat.me/blogs/images/locking.png 1640w' src=https://www.sadat.me/blogs/images/locking.png sizes="(min-width: 768px) 720px, 100vw" width=1640 height=924 alt=Locking><figcaption>Locking</figcaption></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#pessimistic-locking aria-label="Pessimistic Locking">Pessimistic Locking</a><ul><li><a href=#how-it-works aria-label="How It Works">How It Works</a></li><li><a href=#real-world-example aria-label="Real-World Example">Real-World Example</a></li><li><a href=#advantages aria-label=Advantages>Advantages</a></li><li><a href=#disadvantages aria-label=Disadvantages>Disadvantages</a></li></ul></li><li><a href=#optimistic-locking aria-label="Optimistic Locking">Optimistic Locking</a><ul><li><a href=#how-it-works-1 aria-label="How It Works">How It Works</a></li><li><a href=#real-world-example-1 aria-label="Real-World Example">Real-World Example</a></li><li><a href=#advantages-1 aria-label=Advantages>Advantages</a></li><li><a href=#disadvantages-1 aria-label=Disadvantages>Disadvantages</a></li></ul></li><li><a href=#compare-and-swap-cas-mechanism aria-label="Compare-and-Swap (CAS) Mechanism">Compare-and-Swap (CAS) Mechanism</a><ul><li><a href=#how-it-works-2 aria-label="How It Works">How It Works</a></li><li><a href=#real-world-example-2 aria-label="Real-World Example">Real-World Example</a></li><li><a href=#advantages-of-cas aria-label="Advantages of CAS">Advantages of CAS</a></li><li><a href=#disadvantages-of-cas aria-label="Disadvantages of CAS">Disadvantages of CAS</a></li></ul></li><li><a href=#choosing-the-right-approach aria-label="Choosing the Right Approach">Choosing the Right Approach</a></li></ul></div></details></div><div class=post-content><p>In the world of concurrent programming and database management, locking mechanisms are crucial to ensure data consistency and integrity. Two primary approaches to locking are pessimistic and optimistic locking. Each has its own use cases, advantages, and disadvantages. In this blog post we will understand of these two approaches, along with the real-world examples and an introduction to the Compare-and-Swap (CAS) mechanism.</p><h2 id=pessimistic-locking>Pessimistic Locking<a hidden class=anchor aria-hidden=true href=#pessimistic-locking>#</a></h2><p>Pessimistic locking is a strategy where a resource is locked as soon as a transaction starts and remains locked until the transaction is completed. It has been called “pessimistic” because of the assumption that conflicts between concurrent transactions do occur frequently.</p><h3 id=how-it-works>How It Works<a hidden class=anchor aria-hidden=true href=#how-it-works>#</a></h3><ul><li><strong>Lock Acquisition:</strong> If a transaction needs to read or write to certain resources, then it first acquires a lock on those resources.</li><li><strong>Exclusive access:</strong> No other transaction can access the resource under lock until it is released.</li><li><strong>Lock Release:</strong> The lock is released when the transaction is complete, whether through commit or rollback.</li></ul><h3 id=real-world-example>Real-World Example<a hidden class=anchor aria-hidden=true href=#real-world-example>#</a></h3><p>Let’s think about a banking system where users can transfer their money form accounts. If two users try to transfer money from the same account simultaneously, it could lead to inconsistencies. In this situation the pessimistic locking plays the vital role to save from inconsistencies.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>12345</span><span class=w> </span><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- Perform transfer operations
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>accounts</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>balance</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>12345</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>In this example, the <code>FOR UPDATE</code> clause locks the account record, preventing other transactions from modifying it until the current transaction is complete.</p><h3 id=advantages>Advantages<a hidden class=anchor aria-hidden=true href=#advantages>#</a></h3><ul><li><strong>Data Integrity:</strong> Ensures that no other transaction can modify the resource while it is being processed, thus maintaining data integrity.</li><li><strong>Simplicity:</strong> Easier to implement and understand, especially in systems where conflicts are frequent.</li></ul><h3 id=disadvantages>Disadvantages<a hidden class=anchor aria-hidden=true href=#disadvantages>#</a></h3><ul><li><strong>Performance Overhead:</strong> Can lead to significant performance bottlenecks, especially in high-concurrency environments.</li><li><strong>Deadlocks:</strong> Increased risk of deadlocks, where two or more transactions are waiting indefinitely for each other to release locks.</li></ul><hr><h2 id=optimistic-locking>Optimistic Locking<a hidden class=anchor aria-hidden=true href=#optimistic-locking>#</a></h2><p>On the other hand, Optimistic locking use to minimize conflicts that can occur when multiple transactions try to access and modify the same data simultaneously. It’s based on the assumption that conflicts are rare, and therefore, it avoids the overhead of pessimistic locking, which involves acquiring exclusive locks on data before accessing it.</p><h3 id=how-it-works-1>How It Works<a hidden class=anchor aria-hidden=true href=#how-it-works-1>#</a></h3><ul><li><strong>Read:</strong> A transaction reads the data it needs to modify.</li><li><strong>Version:</strong> A version stamp or timestamp is associated with the data to track its state.</li><li><strong>Update:</strong> The transaction modifies the data as needed.</li><li><strong>Write:</strong> When the transaction is ready to commit, it checks the current version stamp of the data against the version stamp it read at the beginning.</li><li><strong>Conflict Detection:</strong> If the version stamps match, the transaction can commit the changes. If they don’t match, it means that the data has been modified by another transaction since the original read, and a conflict has occurred.</li><li><strong>Conflict Resolution:</strong> In case of a conflict, the transaction can read the data again and <strong>retry</strong> the update or it can <strong>abort</strong> the transaction and inform the user about the conflict.</li></ul><h3 id=real-world-example-1>Real-World Example<a hidden class=anchor aria-hidden=true href=#real-world-example-1>#</a></h3><p>Consider an e-commerce platform where multiple users can update product inventory. With optimistic locking, each product record has a version number. When a user updates the inventory, the system checks the version number before committing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>BEGIN</span><span class=w> </span><span class=k>TRANSACTION</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>version</span><span class=p>,</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>98765</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- Perform inventory update
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UPDATE</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>stock</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=k>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>version</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>98765</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>COMMIT</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>If the version number has changed since the initial read, the update fails, and the transaction is retried.</p><h3 id=advantages-1>Advantages<a hidden class=anchor aria-hidden=true href=#advantages-1>#</a></h3><ul><li><strong>Performance:</strong> Better performance in high-concurrency environments as it reduces the time resources are locked.</li><li><strong>Scalability:</strong> More scalable as it allows multiple transactions to proceed without waiting for locks.</li><li><strong>Implementation:</strong> It’s generally easier to implement than pessimistic locking.</li></ul><h3 id=disadvantages-1>Disadvantages<a hidden class=anchor aria-hidden=true href=#disadvantages-1>#</a></h3><ul><li><strong>Complexity:</strong> More complex to implement and manage, especially in systems with frequent conflicts.</li><li><strong>Retry Overhead:</strong> Transactions may need to be retried multiple times, leading to increased overhead.</li></ul><hr><h2 id=compare-and-swap-cas-mechanism>Compare-and-Swap (CAS) Mechanism<a hidden class=anchor aria-hidden=true href=#compare-and-swap-cas-mechanism>#</a></h2><p>Compare-and-Swap (CAS) is a hardware-level atomic instruction used for efficient synchronization in multi-threaded programming to avoid locking algorithm.</p><h3 id=how-it-works-2>How It Works<a hidden class=anchor aria-hidden=true href=#how-it-works-2>#</a></h3><ul><li><strong>Read:</strong> The CAS operation reads the current value of a variable.</li><li><strong>Compare:</strong> It compares the read value with an expected value that provided.</li><li><strong>Swap:</strong> If the read value matches the expected value, the CAS instruction atomically updates with the new value. If the values don’t match, the CAS instruction fails without modifying.</li></ul><h3 id=real-world-example-2>Real-World Example<a hidden class=anchor aria-hidden=true href=#real-world-example-2>#</a></h3><p>In Go, CAS can be implemented using the <code>sync/atomic</code> package.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sync/atomic&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>counter</span> <span class=nx>atomic</span><span class=p>.</span><span class=nx>Int32</span>
</span></span><span class=line><span class=cl>    <span class=nx>counter</span><span class=p>.</span><span class=nf>Store</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>wg</span> <span class=o>:=</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>WaitGroup</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>wg</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span> <span class=o>:=</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>oldValue</span><span class=p>,</span> <span class=nx>newValue</span> <span class=o>:=</span> <span class=nx>counter</span><span class=p>.</span><span class=nf>Load</span><span class=p>(),</span> <span class=nx>counter</span><span class=p>.</span><span class=nf>Load</span><span class=p>()</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=nx>swapped</span> <span class=o>:=</span> <span class=nx>counter</span><span class=p>.</span><span class=nf>CompareAndSwap</span><span class=p>(</span><span class=nx>oldValue</span><span class=p>,</span> <span class=nx>newValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>!</span><span class=nx>swapped</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Failed to swap&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>wg</span><span class=p>.</span><span class=nf>Done</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>100</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>go</span> <span class=nf>increment</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>wg</span><span class=p>.</span><span class=nf>Wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>counter</span><span class=p>.</span><span class=nf>Load</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In this example, <code>CompareAndSwap</code> ensures that the increment operation is performed atomically.</p><h3 id=advantages-of-cas>Advantages of CAS<a hidden class=anchor aria-hidden=true href=#advantages-of-cas>#</a></h3><ul><li><strong>Higher Performance:</strong> CAS is non-blocking by nature operation, which lead to better performance in high concurrent situation.</li><li><strong>Lower Overhead:</strong> CAS doesn’t require the overhead of context switch and thread scheduling, which can be significant to some extent.</li></ul><h3 id=disadvantages-of-cas>Disadvantages of CAS<a hidden class=anchor aria-hidden=true href=#disadvantages-of-cas>#</a></h3><ul><li><strong>Complexity:</strong> CAS implementation can be more complex than traditional locking, and it’s true when it comes to understanding the implementation in some cases.</li><li><strong>Potential for Busy Waiting:</strong> If CAS operations fail frequently, it can lead to busy waiting, where threads continuously retry the operation until they succeed.</li></ul><hr><h2 id=choosing-the-right-approach>Choosing the Right Approach<a hidden class=anchor aria-hidden=true href=#choosing-the-right-approach>#</a></h2><p>The choice between pessimistic locking, optimistic locking, and CAS depends on the specific requirements and characteristics of your system:</p><ul><li><strong>High Conflict:</strong> If your system experiences high contention for resources, pessimistic locking may be more suitable to ensure data integrity.</li><li><strong>Low Contention:</strong> In systems with low contention, optimistic locking can provide better performance and scalability.</li><li><strong>Complexity vs. Performance:</strong> Consider the trade-off between implementation complexity and performance. Pessimistic locking is simpler but may lead to performance bottlenecks, while optimistic locking and CAS are more complex but can offer better performance in the right scenarios.</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.sadat.me/blogs/tags/locking/>Locking</a></li><li><a href=https://www.sadat.me/blogs/tags/database/>Database</a></li></ul><nav class=paginav><a class=prev href=https://www.sadat.me/blogs/posts/encryption/whatsapp/><span class=title>« Prev</span><br><span>WhatsApp এর এনক্রিপশন প্রসেস</span>
</a><a class=next href=https://www.sadat.me/blogs/posts/git/worktree/><span class=title>Next »</span><br><span>Git Worktrees</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Understanding Locking: Pessimistic and Optimistic Approaches on x" href="https://x.com/intent/tweet/?text=Understanding%20Locking%3a%20Pessimistic%20and%20Optimistic%20Approaches&amp;url=https%3a%2f%2fwww.sadat.me%2fblogs%2fposts%2fmisc%2flocking%2f&amp;hashtags=Locking%2cDatabase"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Understanding Locking: Pessimistic and Optimistic Approaches on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.sadat.me%2fblogs%2fposts%2fmisc%2flocking%2f&amp;title=Understanding%20Locking%3a%20Pessimistic%20and%20Optimistic%20Approaches&amp;summary=Understanding%20Locking%3a%20Pessimistic%20and%20Optimistic%20Approaches&amp;source=https%3a%2f%2fwww.sadat.me%2fblogs%2fposts%2fmisc%2flocking%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Understanding Locking: Pessimistic and Optimistic Approaches on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.sadat.me%2fblogs%2fposts%2fmisc%2flocking%2f&title=Understanding%20Locking%3a%20Pessimistic%20and%20Optimistic%20Approaches"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Understanding Locking: Pessimistic and Optimistic Approaches on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.sadat.me%2fblogs%2fposts%2fmisc%2flocking%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Understanding Locking: Pessimistic and Optimistic Approaches on whatsapp" href="https://api.whatsapp.com/send?text=Understanding%20Locking%3a%20Pessimistic%20and%20Optimistic%20Approaches%20-%20https%3a%2f%2fwww.sadat.me%2fblogs%2fposts%2fmisc%2flocking%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Understanding Locking: Pessimistic and Optimistic Approaches on telegram" href="https://telegram.me/share/url?text=Understanding%20Locking%3a%20Pessimistic%20and%20Optimistic%20Approaches&amp;url=https%3a%2f%2fwww.sadat.me%2fblogs%2fposts%2fmisc%2flocking%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Understanding Locking: Pessimistic and Optimistic Approaches on ycombinator" href="https://news.ycombinator.com/submitlink?t=Understanding%20Locking%3a%20Pessimistic%20and%20Optimistic%20Approaches&u=https%3a%2f%2fwww.sadat.me%2fblogs%2fposts%2fmisc%2flocking%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.sadat.me/blogs/>Caffeines</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>